# 🔁 Prompt Refinement using DDPG and SentenceTransformer

This project implements a Deep Deterministic Policy Gradient (DDPG) reinforcement learning agent that refines user prompts to maximize the quality of responses generated by a large language model (LLM) such as Groq API or ChatGPT. The agent uses SentenceTransformer embeddings to measure improvements and is accessible via a Flask-based REST API.

---

## 📁 Project Structure

```
DDPG/
├── app.py               # Flask API server to receive prompts and return refined responses
├── inference_test.py    # Command-line interface for testing prompt refinement
├── main.py              # Trains the DDPG agent on prompt-reward interaction
├── model.py             # Actor, Critic, ReplayBuffer, and DDPGAgent definitions
├── utils.py             # PromptEnvironment with reward function
├── test_ddpg.py         # Unit test for DDPG inference
├── test_env.py          # Unit test for the environment and reward
├── saved_model/         # Trained model weights saved here
├── requirements.txt     # Required Python packages
└── README.md            # Project documentation (this file)
```

---

## ⚙️ Setup Instructions

### 1. 🐍 Create and activate a virtual environment

```bash
python -m venv venv
# Windows:
venv\Scripts\activate
# macOS/Linux:
source venv/bin/activate
```

### 2. 📦 Install dependencies

```bash
pip install -r requirements.txt
```

---

## Configure Groq API

GROQ_API_KEY=key
GROQ_API_BASE=https://api.groq.com/openai/v1


## 🧠 Train the DDPG Agent

Run the following command to train the DDPG agent using prompt refinements and sentiment-based rewards:

```bash
python main.py
```

- After training, the model is saved to:

```
saved_model/ddpg_actor.pth
```

---

## 🤖 Command-line Inference

Use the trained model to refine prompts interactively:

```bash
python inference_test.py
```

Example:

```
🔍 Enter your prompt: Give me code for GRU
✨ Refined Prompt: Please provide code for GRU neural network.
💬 LLM Response: <response from Groq or OpenAI>
```

---

## 🌐 Run the Flask API

Serve the refined prompt generator as a REST API:

```bash
python app.py
```

It runs at: [http://127.0.0.1:5000/refine](http://127.0.0.1:5000/refine)

### Example cURL usage:

```bash
curl -X POST http://127.0.0.1:5000/refine \
     -H "Content-Type: application/json" \
     -d "{\"prompt\": \"Give me code for GRU\"}"
```

---

## 🧾 Reward Function

The reward is computed as a weighted sum of:

- ✅ **Cosine Similarity** between original and refined prompt embeddings
- ✅ **Sentiment Consistency** using VADER sentiment analysis

---

## 📦 Example Output

```
Original Prompt: give code for GRU
Refined Prompt: Please provide implementation of GRU using Keras.
LLM Response: Here is an example GRU model in Keras...
Reward: 46.72
```

---

## 🧪 Run Unit Tests

```bash
python test_ddpg.py
python test_env.py
```

---

## 📋 Requirements

```txt
torch
transformers
sentence-transformers
Flask
nltk
scikit-learn
```




